<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: background.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: background.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Script that runs at all times when the extension is loaded.
 * @file 
 * @module background.js
 * @author Paul Larsen 
 */



global.browser = require('webextension-polyfill')

var appEnabled = false;
var storageChange;
var localList = [ ];
var blacklist = [ ];
var openlist = [ ];
var listIndex = 0;
var debug = false

/**  
 * @event
 * @name 'chrome.storage.onChanged'
 * @description
 * Detects when chrome storage is changed and updates the local variables.
 * Calls updateLists() and updateListener() when a change is detected.
 * When appEnabled is toggled to true, it also calls openTabs().
 * @author Paul Larsen
 */
chrome.storage.onChanged.addListener(function(changes, namespace) {
  for (var key in changes) {
    storageChange = changes[key];
    if (debug)
      alert("Change detected");
    if (key == "list") {
      localList = changes[key].newValue;
      if (debug)
        alert("list changed");
    }
    if (key == "index") {
      listIndex = changes[key].newValue;
      if (debug)
        alert("index changed");
    }
    if (key == "appEnabled") {
      appEnabled = changes[key].newValue;
      if (appEnabled) {
        openTabs();
      }
      if (debug)
        alert("appEnabled changed");
    }
    
  }
  updateLists();
  updateListener();
});

/**
 * @function updateListener
 * @description 
 * Called when a storage change is detected.
 * Updates the chrome.tabs listener that checks for blacklisted websites and removes them.
 * @author Paul Larsen 
 */
function updateListener() {
  if (debug)
    alert("Updating listener");
  chrome.tabs.onUpdated.addListener(function (id, info, tab) {
    if (appEnabled) {
      var i;    
      for (i = 0; i &lt; blacklist.length; i++) {
        if (blacklist[i].enabled &amp;&amp; (tab.url.toLowerCase().indexOf(blacklist[i].site) != -1)) {
          chrome.tabs.remove(tab.id);
        }
      }
    }
  })
}

/**
 * @function updateLists
 * @description 
 * Called when a storage change is detected.
 * Updates the blacklist and openlist vars for local use.
 * @author Paul Larsen 
 */
function updateLists() {
  if (debug)
    alert("Updating lists");
  blacklist = localList[listIndex].blacklist;
  openlist = localList[listIndex].openlist;
} 

/**
 * @function openTabs
 * @description 
 * Called when a storage change is detected and appEnabled has been toggled to true.
 * Opens the urls listed in the openlist var.
 * @author Paul Larsen 
 */
function openTabs() {
  var i;
  for (i = 0; i &lt; openlist.length; i++) {
    if (openlist[i].enabled) {
      //The string concatenation below was added to make auto-open and blacklisted inputs similar
      chrome.tabs.create({ url: 'http://' + openlist[i].site })
    }  
  }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="background.module_js.html">background.js</a></li><li><a href="module-popup.html">popup</a></li></ul><h3>Events</h3><ul><li><a href="background.module_js.html#~event:'chrome.storage.onChanged'">'chrome.storage.onChanged'</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Tue Jun 02 2020 02:40:47 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
